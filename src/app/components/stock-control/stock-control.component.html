<div class="stock-control-container">
  <div class="header">
    <h1>Controle de Estoque</h1>
    <p class="subtitle">Gerencie entradas e saídas de produtos</p>
  </div>

  <!-- Filtros -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters-grid">
        <mat-form-field appearance="outline">
          <mat-label>Buscar Produto</mat-label>
          <mat-icon matPrefix>search</mat-icon>
          <input matInput [(ngModel)]="searchTerm" (input)="applyFilters()">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Categoria</mat-label>
          <mat-select [(ngModel)]="categoryFilter" (selectionChange)="applyFilters()">
            <mat-option value="all">Todas</mat-option>
            <mat-option value="Eletrônicos">Eletrônicos</mat-option>
            <mat-option value="Periféricos">Periféricos</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select [(ngModel)]="statusFilter" (selectionChange)="applyFilters()">
            <mat-option value="all">Todos</mat-option>
            <mat-option value="ok">Normal</mat-option>
            <mat-option value="low">Baixo</mat-option>
            <mat-option value="out">Esgotado</mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-raised-button (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Limpar
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Estatísticas -->
  <div class="stats-grid">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>inventory_2</mat-icon>
        </div>
        <div class="stat-info">
          <span class="stat-label">Total em Estoque</span>
          <span class="stat-value">{{ totalItems }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card warning">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>warning</mat-icon>
        </div>
        <div class="stat-info">
          <span class="stat-label">Estoque Baixo</span>
          <span class="stat-value">{{ lowStockCount }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card danger">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>error</mat-icon>
        </div>
        <div class="stat-info">
          <span class="stat-label">Esgotados</span>
          <span class="stat-value">{{ outOfStockCount }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>attach_money</mat-icon>
        </div>
        <div class="stat-info">
          <span class="stat-label">Valor Total</span>
          <span class="stat-value">R$ {{ totalValue.toFixed(2) }}</span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Tabela -->
  <mat-card class="table-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>list</mat-icon>
        Produtos em Estoque
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="table-container">
        <table mat-table [dataSource]="filteredItems">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Produto</th>
            <td mat-cell *matCellDef="let item">{{ item.name }}</td>
          </ng-container>

          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef>Categoria</th>
            <td mat-cell *matCellDef="let item">{{ item.category }}</td>
          </ng-container>

          <ng-container matColumnDef="currentStock">
            <th mat-header-cell *matHeaderCellDef>Estoque Atual</th>
            <td mat-cell *matCellDef="let item" class="stock-cell">{{ item.currentStock }}</td>
          </ng-container>

          <ng-container matColumnDef="minStock">
            <th mat-header-cell *matHeaderCellDef>Estoque Mínimo</th>
            <td mat-cell *matCellDef="let item">{{ item.minStock }}</td>
          </ng-container>

          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef>Preço</th>
            <td mat-cell *matCellDef="let item">R$ {{ item.price.toFixed(2) }}</td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let item">
              <mat-chip 
                [class.status-ok]="item.status === 'ok'"
                [class.status-low]="item.status === 'low'"
                [class.status-out]="item.status === 'out'">
                {{ getStatusLabel(item.status) }}
              </mat-chip>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Ações</th>
            <td mat-cell *matCellDef="let item">
              <button mat-icon-button (click)="addStock(item)" matTooltip="Adicionar">
                <mat-icon>add_circle</mat-icon>
              </button>
              <button mat-icon-button (click)="removeStock(item)" matTooltip="Remover">
                <mat-icon>remove_circle</mat-icon>
              </button>
              <button mat-icon-button (click)="viewHistory(item)" matTooltip="Histórico">
                <mat-icon>history</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>
</div>
